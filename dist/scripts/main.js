var Stats=function(){var a=Date.now(),b=a,c=0,d=1/0,e=0,f=0,g=1/0,h=0,i=0,j=0,k=document.createElement("div");k.id="stats",k.addEventListener("mousedown",function(a){a.preventDefault(),s(++j%2)},!1),k.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",k.appendChild(l);var m=document.createElement("div");m.id="fpsText",m.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="FPS",l.appendChild(m);var n=document.createElement("div");for(n.id="fpsGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(n);74>n.children.length;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#113",n.appendChild(o)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",k.appendChild(p);var q=document.createElement("div");q.id="msText",q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",q.innerHTML="MS",p.appendChild(q);var r=document.createElement("div");for(r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(r);74>r.children.length;)o=document.createElement("span"),o.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(o);var s=function(a){switch(j=a){case 0:l.style.display="block",p.style.display="none";break;case 1:l.style.display="none",p.style.display="block"}};return{REVISION:11,domElement:k,setMode:s,begin:function(){a=Date.now()},end:function(){var j=Date.now();c=j-a,d=Math.min(d,c),e=Math.max(e,c),q.textContent=c+" MS ("+d+"-"+e+")";var k=Math.min(30,30-30*(c/200));return r.appendChild(r.firstChild).style.height=k+"px",i++,j>b+1e3&&(f=Math.round(1e3*i/(j-b)),g=Math.min(g,f),h=Math.max(h,f),m.textContent=f+" FPS ("+g+"-"+h+")",k=Math.min(30,30-30*(f/100)),n.appendChild(n.firstChild).style.height=k+"px",b=j,i=0),j},update:function(){a=this.end()}}},App,Objects,AppView=Backbone.View.extend({el:"body",events:{"change input":"settingsChanged"},initialize:function(){var a=this;this.width=$("#world").width(),this.height=$("#world").width(),this.windowHalfX=this.width/2,this.windowHalfY=this.height/2,this.objects={},this.container=$("#world").get(0),this.camera=new THREE.PerspectiveCamera(60,this.width/this.height,1,2e3),this.camera.position.z=500,this.scene=new THREE.Scene,this.scene.add(this.camera),this.camera.lookAt(this.scene.position),this.group=new THREE.Object3D,this.scene.add(this.group),this.loader=new THREE.TextureLoader,this.loader.load("images/land_ocean_ice_cloud_2048.jpg",function(b){a.WorldGeometry=new THREE.SphereGeometry(200,20,20),a.WorldGeometry.mergeVertices();var c=new THREE.MeshLambertMaterial({map:b,overdraw:.5});a.WorldMesh=new THREE.Mesh(a.WorldGeometry,c),a.WorldMesh.position.set(0,0,0),a.group.add(a.WorldMesh),a.worldLoaded()});var b=document.createElement("canvas");b.width=128,b.height=128;var c=b.getContext("2d"),d=c.createRadialGradient(b.width/2,b.height/2,0,b.width/2,b.height/2,b.width/2);d.addColorStop(.1,"rgba(210,210,210,1)"),d.addColorStop(1,"rgba(255,255,255,1)"),c.fillStyle=d,c.fillRect(0,0,b.width,b.height);var e=new THREE.Texture(b);e.needsUpdate=!0;var f=new THREE.PlaneGeometry(300,300,3,3),g=new THREE.MeshBasicMaterial({map:e,overdraw:.5}),h=new THREE.Mesh(f,g);h.position.y=-200,h.rotation.x=-Math.PI/2,this.group.add(h),this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(16777215),this.renderer.setSize(this.width,this.height),this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.container.appendChild(this.renderer.domElement);var i=new THREE.AmbientLight(4210752);this.scene.add(i);var j=new THREE.DirectionalLight(16777215);j.position=this.camera.position,this.scene.add(j),this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.container.appendChild(this.stats.domElement),$(window).resize(this.resize),this.animate()},addObject:function(a){var b=this;this.loader.load(a.image,function(c){switch(a.geometry){case"sphere":var d=new THREE.SphereGeometry(a.w,a.w/2,a.w/2);break;default:var d=new THREE.CubeGeometry(a.h,a.w,a.w)}var e=new THREE.MeshLambertMaterial({map:c,overdraw:.5}),f=new THREE.Mesh(d,e),g=b.getRand(a.vertice[0],a.vertice[1]);f.position=b.WorldGeometry.vertices[g].clone().multiplyScalar(1.1),b.objects[a.label]=f,b.group.add(f)})},resize:function(){this.width=$("#world").width(),this.height=$("#world").width(),this.windowHalfX=this.width/2,this.windowHalfY=this.height/2,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)},animate:function(){var a=this;requestAnimationFrame(function(){a.animate()}),this.render(),this.controls.update(),this.stats.update()},render:function(){this.group.rotation.y-=.005,this.renderer.render(this.scene,this.camera)},worldLoaded:function(){},settingsChanged:function(a){var b=$(a.target),c=b.prop("name"),d=b.val();console.log("Settings changed",b.prop("name")),$("#"+b.data("value")).text(b.val()),this.clearObjects(c),this.addObjects(c,d)},clearObjects:function(a){var b;for(var c in Objects[a])b=Objects[a][c],this.group.remove(this.objects[b.label]),delete this.objects[b.label]},addObjects:function(a,b){var c=1;for(var d in Objects[a]){if(c>b)break;this.addObject(Objects[a][d]),c++}},getRand:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)}});Objects={travel:[{label:"eiffel",image:"images/eiffel.png",vertice:[0,200],geometry:"plane",w:40,h:40},{label:"sagrada",image:"images/sagrada-familia.png",vertice:[0,200],geometry:"plane",w:40,h:40},{label:"pyramid",image:"images/pyramid.png",vertice:[0,200],geometry:"plane",w:40,h:40},{label:"liberty",image:"images/liberty.png",vertice:[0,200],geometry:"plane",w:40,h:40},{label:"bigben",image:"images/big-ben.png",vertice:[0,200],geometry:"plane",w:40,h:40}],sports:[{label:"football",image:"images/football_texture.png",vertice:[200,300],geometry:"sphere",w:40,h:20},{label:"basketball",image:"images/basketball_texture.jpg",vertice:[200,300],geometry:"sphere",w:40,h:20},{label:"baseball",image:"images/baseball_texture.jpg",vertice:[200,300],geometry:"sphere",w:40,h:20},{label:"golf",image:"images/golf_texture.jpg",vertice:[200,300],geometry:"sphere",w:40,h:20},{label:"tennis",image:"images/tennis_texture.jpg",vertice:[200,300],geometry:"sphere",w:40,h:20}]},$(function(){App=new AppView});