var Stats=function(){var a=Date.now(),b=a,c=0,d=1/0,e=0,f=0,g=1/0,h=0,i=0,j=0,k=document.createElement("div");k.id="stats",k.addEventListener("mousedown",function(a){a.preventDefault(),s(++j%2)},!1),k.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",k.appendChild(l);var m=document.createElement("div");m.id="fpsText",m.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="FPS",l.appendChild(m);var n=document.createElement("div");for(n.id="fpsGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(n);74>n.children.length;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#113",n.appendChild(o)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",k.appendChild(p);var q=document.createElement("div");q.id="msText",q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",q.innerHTML="MS",p.appendChild(q);var r=document.createElement("div");for(r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(r);74>r.children.length;)o=document.createElement("span"),o.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(o);var s=function(a){switch(j=a){case 0:l.style.display="block",p.style.display="none";break;case 1:l.style.display="none",p.style.display="block"}};return{REVISION:11,domElement:k,setMode:s,begin:function(){a=Date.now()},end:function(){var j=Date.now();c=j-a,d=Math.min(d,c),e=Math.max(e,c),q.textContent=c+" MS ("+d+"-"+e+")";var k=Math.min(30,30-30*(c/200));return r.appendChild(r.firstChild).style.height=k+"px",i++,j>b+1e3&&(f=Math.round(1e3*i/(j-b)),g=Math.min(g,f),h=Math.max(h,f),m.textContent=f+" FPS ("+g+"-"+h+")",k=Math.min(30,30-30*(f/100)),n.appendChild(n.firstChild).style.height=k+"px",b=j,i=0),j},update:function(){a=this.end()}}},AppView=Backbone.View.extend({el:"body",events:{"change input":"settingsChanged"},initialize:function(){var a=this;this.width=$("#world").width(),this.height=$("#world").width(),this.windowHalfX=this.width/2,this.windowHalfY=this.height/2,this.objects={},this.container=$("#world").get(0),this.camera=new THREE.PerspectiveCamera(60,this.width/this.height,1,2e3),this.camera.position.z=500,this.scene=new THREE.Scene,this.scene.add(this.camera),this.camera.lookAt(this.scene.position),this.group=new THREE.Object3D,this.scene.add(this.group);var b=new THREE.TextureLoader;b.load("images/land_ocean_ice_cloud_2048.jpg",function(b){a.WorldGeometry=new THREE.SphereGeometry(200,20,20),a.WorldGeometry.mergeVertices();var c=new THREE.MeshBasicMaterial({map:b,overdraw:.5});a.WorldMesh=new THREE.Mesh(a.WorldGeometry,c),a.WorldMesh.position.set(0,0,0),a.group.add(a.WorldMesh),a.worldLoaded()});var c=document.createElement("canvas");c.width=128,c.height=128;var d=c.getContext("2d"),e=d.createRadialGradient(c.width/2,c.height/2,0,c.width/2,c.height/2,c.width/2);e.addColorStop(.1,"rgba(210,210,210,1)"),e.addColorStop(1,"rgba(255,255,255,1)"),d.fillStyle=e,d.fillRect(0,0,c.width,c.height);var f=new THREE.Texture(c);f.needsUpdate=!0;var g=new THREE.PlaneGeometry(300,300,3,3),h=new THREE.MeshBasicMaterial({map:f,overdraw:.5}),i=new THREE.Mesh(g,h);i.position.y=-200,i.rotation.x=-Math.PI/2,this.group.add(i),this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(16777215),this.renderer.setSize(this.width,this.height),this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.container.appendChild(this.renderer.domElement),this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.container.appendChild(this.stats.domElement),$(window).resize(this.resize),this.animate()},addPlane:function(a){var b=this,c=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(a.image)});c.map.needsUpdate=!0,c.transparent=!0;var d=new THREE.Mesh(new THREE.PlaneGeometry(a.w,a.h),c),e=this.getRand(a.vertice[0],a.vertice[1]);d.overdraw=!0,d.material.side=THREE.DoubleSide,d.position=b.WorldGeometry.vertices[e].clone().multiplyScalar(1.1),this.objects[a.label]=d,b.group.add(this.objects[a.label])},resize:function(){this.width=$("#world").width(),this.height=$("#world").width(),this.windowHalfX=this.width/2,this.windowHalfY=this.height/2,this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)},animate:function(){var a=this;requestAnimationFrame(function(){a.animate()}),this.render(),this.controls.update(),this.stats.update()},render:function(){this.group.rotation.y-=.005,this.renderer.render(this.scene,this.camera)},worldLoaded:function(){},settingsChanged:function(a){var b=$(a.target),c=b.prop("name"),d=b.val();console.log("Settings changed",b.prop("name")),$("#"+b.data("value")).text(b.val()),this.clearPlanes(c),this.addPlanes(c,d)},clearPlanes:function(a){var b;for(var c in Objects[a])b=Objects[a][c],this.group.remove(this.objects[b.label]),delete this.objects[b.label]},addPlanes:function(a,b){var c=1;for(var d in Objects[a]){if(c>b)break;this.addPlane(Objects[a][d]),c++}},getRand:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)}}),App,Objects={travel:[{label:"eiffel",image:"images/eiffel.png",vertice:[0,250],w:50,h:50},{label:"sagrada",image:"images/sagrada-familia.png",vertice:[0,250],w:50,h:50},{label:"pyramid",image:"images/pyramid.png",vertice:[0,250],w:50,h:50},{label:"liberty",image:"images/liberty.png",vertice:[0,250],w:50,h:50},{label:"bigben",image:"images/big-ben.png",vertice:[0,250],w:50,h:50}],sports:[{label:"football",image:"images/ball.png",vertice:[150,350],w:50,h:50},{label:"basketball",image:"images/basketball.png",vertice:[150,350],w:50,h:50},{label:"baseball",image:"images/baseball.gif",vertice:[150,350],w:50,h:50},{label:"golf",image:"images/golf.png",vertice:[150,350],w:50,h:50},{label:"tennis",image:"images/tennis.png",vertice:[150,350],w:50,h:50}]};$(function(){App=new AppView});